<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üñºÔ∏è Prueba Sistema de Im√°genes - OrganizApp</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }
        .card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        .preview-container {
            position: relative;
            margin-top: 1rem;
        }
        .preview-image {
            max-width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 0.75rem;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        .remove-btn {
            position: absolute;
            top: -8px;
            right: -8px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
            transition: all 0.2s;
        }
        .remove-btn:hover {
            transform: scale(1.1) rotate(90deg);
            background: #dc2626;
        }
        .upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 1rem 2rem;
            border-radius: 0.75rem;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 20px rgba(102, 126, 234, 0.4);
        }
        .upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 30px rgba(102, 126, 234, 0.6);
        }
        .stats {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-top: 1rem;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .image-list-item {
            background: #f3f4f6;
            padding: 1rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            transition: all 0.3s;
        }
        .image-list-item:hover {
            transform: translateX(5px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
        }
        .image-list-item img {
            width: 60px;
            height: 60px;
            object-fit: cover;
            border-radius: 0.5rem;
            cursor: pointer;
        }
    </style>
</head>
<body>
    <div class="max-w-4xl mx-auto">
        <!-- Header -->
        <div class="text-center mb-8 fade-in">
            <h1 class="text-5xl font-bold text-white mb-3">üñºÔ∏è Prueba de Im√°genes</h1>
            <p class="text-xl text-white/90">Sistema de Compresi√≥n y Almacenamiento</p>
            <p class="text-sm text-white/70 mt-2">OrganizApp v2.0</p>
        </div>

        <!-- Main Card -->
        <div class="card p-8 fade-in">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">üì§ Subir y Comprimir Imagen</h2>
            
            <!-- Upload Button -->
            <div class="mb-6">
                <input type="file" id="imageInput" accept="image/*" class="hidden">
                <button onclick="document.getElementById('imageInput').click()" class="upload-btn">
                    <span class="text-3xl">üì∑</span>
                    <span class="font-semibold">Seleccionar Imagen</span>
                </button>
            </div>

            <!-- Preview Container -->
            <div id="previewContainer" class="hidden preview-container">
                <div class="relative inline-block">
                    <img id="previewImage" src="" alt="Preview" class="preview-image">
                    <button id="removeBtn" class="remove-btn">‚úï</button>
                </div>
                <div class="stats">
                    <div class="grid grid-cols-2 gap-4 text-sm">
                        <div>
                            <p class="opacity-80">üìè Tama√±o Original:</p>
                            <p class="font-bold" id="originalSize">-</p>
                        </div>
                        <div>
                            <p class="opacity-80">‚ö° Tama√±o Comprimido:</p>
                            <p class="font-bold" id="compressedSize">-</p>
                        </div>
                        <div>
                            <p class="opacity-80">üìê Dimensiones Originales:</p>
                            <p class="font-bold" id="originalDimensions">-</p>
                        </div>
                        <div>
                            <p class="opacity-80">üéØ Dimensiones Finales:</p>
                            <p class="font-bold" id="finalDimensions">-</p>
                        </div>
                    </div>
                    <div class="mt-4 pt-4 border-t border-white/20">
                        <p class="opacity-80">üíæ Reducci√≥n:</p>
                        <p class="font-bold text-2xl" id="reductionPercent">-</p>
                    </div>
                </div>
            </div>

            <!-- Action Buttons -->
            <div id="actionButtons" class="hidden mt-6 flex gap-4">
                <button onclick="saveToLocalStorage()" class="bg-green-500 hover:bg-green-600 text-white px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105">
                    üíæ Guardar en LocalStorage
                </button>
                <button onclick="viewFullSize()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105">
                    üîç Ver Tama√±o Completo
                </button>
                <button onclick="downloadImage()" class="bg-purple-500 hover:bg-purple-600 text-white px-6 py-3 rounded-lg font-semibold transition-all transform hover:scale-105">
                    ‚¨áÔ∏è Descargar Comprimida
                </button>
            </div>
        </div>

        <!-- Saved Images List -->
        <div id="savedImagesSection" class="card p-8 mt-8 fade-in hidden">
            <h2 class="text-2xl font-bold mb-6 text-gray-800">üíæ Im√°genes Guardadas en LocalStorage</h2>
            <div id="savedImagesList"></div>
            <button onclick="clearAllSaved()" class="mt-4 bg-red-500 hover:bg-red-600 text-white px-6 py-2 rounded-lg font-semibold transition-all">
                üóëÔ∏è Limpiar Todas
            </button>
        </div>

        <!-- Info Card -->
        <div class="card p-8 mt-8 fade-in">
            <h2 class="text-2xl font-bold mb-4 text-gray-800">‚ÑπÔ∏è Informaci√≥n del Sistema</h2>
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-600">
                <div class="bg-blue-50 p-4 rounded-lg">
                    <p class="font-bold text-blue-900">‚úÖ Formatos Soportados:</p>
                    <p>JPEG, PNG, GIF, WebP</p>
                </div>
                <div class="bg-green-50 p-4 rounded-lg">
                    <p class="font-bold text-green-900">üìä Tama√±o M√°ximo:</p>
                    <p>2 MB despu√©s de compresi√≥n</p>
                </div>
                <div class="bg-purple-50 p-4 rounded-lg">
                    <p class="font-bold text-purple-900">üé® Calidad:</p>
                    <p>80% (ajustable)</p>
                </div>
                <div class="bg-orange-50 p-4 rounded-lg">
                    <p class="font-bold text-orange-900">üìê Resoluci√≥n M√°xima:</p>
                    <p>1200 x 1200 px</p>
                </div>
            </div>
        </div>

        <!-- Instructions -->
        <div class="text-center mt-8 text-white/80 text-sm">
            <p>üí° Tip: Prueba con diferentes im√°genes para ver la compresi√≥n en acci√≥n</p>
            <p class="mt-2">üöÄ Este es el mismo sistema usado en OrganizApp</p>
        </div>
    </div>

    <!-- Full Size Modal -->
    <div id="fullSizeModal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4" onclick="closeFullSize()">
        <div class="relative max-w-4xl w-full">
            <button onclick="closeFullSize()" class="absolute -top-12 right-0 text-white hover:text-gray-300 text-4xl">‚úï</button>
            <img id="fullSizeImage" src="" alt="Full Size" class="w-full h-auto rounded-xl shadow-2xl">
        </div>
    </div>

    <script>
        let currentImageData = null;
        const MAX_SIZE = 2 * 1024 * 1024; // 2MB
        const MAX_DIMENSION = 1200;
        const QUALITY = 0.8;

        // Event Listeners
        document.getElementById('imageInput').addEventListener('change', handleImageSelection);
        document.getElementById('removeBtn').addEventListener('click', clearImage);

        // Load saved images on start
        loadSavedImages();

        async function handleImageSelection(event) {
            const file = event.target.files[0];
            if (!file) return;

            const originalSize = file.size;
            document.getElementById('originalSize').textContent = formatBytes(originalSize);

            try {
                const compressedData = await compressImage(file);
                currentImageData = compressedData;

                // Show preview
                document.getElementById('previewImage').src = compressedData;
                document.getElementById('previewContainer').classList.remove('hidden');
                document.getElementById('actionButtons').classList.remove('hidden');

                // Show compressed size
                const compressedSize = Math.round(compressedData.length * 0.75);
                document.getElementById('compressedSize').textContent = formatBytes(compressedSize);

                // Calculate reduction
                const reduction = ((1 - compressedSize / originalSize) * 100).toFixed(1);
                document.getElementById('reductionPercent').textContent = `${reduction}% menos`;
            } catch (error) {
                alert('‚ùå Error al procesar imagen: ' + error.message);
            }
        }

        async function compressImage(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                
                reader.onload = (e) => {
                    const img = new Image();
                    
                    img.onload = () => {
                        // Original dimensions
                        document.getElementById('originalDimensions').textContent = `${img.width} x ${img.height} px`;

                        const canvas = document.createElement('canvas');
                        const ctx = canvas.getContext('2d');

                        // Calculate new dimensions
                        let width = img.width;
                        let height = img.height;

                        if (width > MAX_DIMENSION || height > MAX_DIMENSION) {
                            const ratio = Math.min(MAX_DIMENSION / width, MAX_DIMENSION / height);
                            width *= ratio;
                            height *= ratio;
                        }

                        canvas.width = width;
                        canvas.height = height;

                        // Final dimensions
                        document.getElementById('finalDimensions').textContent = `${width.toFixed(0)} x ${height.toFixed(0)} px`;

                        // Draw and compress
                        ctx.drawImage(img, 0, 0, width, height);
                        const compressed = canvas.toDataURL('image/jpeg', QUALITY);

                        resolve(compressed);
                    };

                    img.onerror = () => reject(new Error('Error al cargar imagen'));
                    img.src = e.target.result;
                };

                reader.onerror = () => reject(new Error('Error al leer archivo'));
                reader.readAsDataURL(file);
            });
        }

        function clearImage() {
            document.getElementById('imageInput').value = '';
            document.getElementById('previewContainer').classList.add('hidden');
            document.getElementById('actionButtons').classList.add('hidden');
            currentImageData = null;
        }

        function saveToLocalStorage() {
            if (!currentImageData) return;

            const saved = JSON.parse(localStorage.getItem('testImages') || '[]');
            saved.push({
                id: Date.now(),
                data: currentImageData,
                date: new Date().toLocaleString()
            });
            localStorage.setItem('testImages', JSON.stringify(saved));

            alert('‚úÖ Imagen guardada en LocalStorage');
            loadSavedImages();
        }

        function loadSavedImages() {
            const saved = JSON.parse(localStorage.getItem('testImages') || '[]');
            const container = document.getElementById('savedImagesList');
            const section = document.getElementById('savedImagesSection');

            if (saved.length === 0) {
                section.classList.add('hidden');
                return;
            }

            section.classList.remove('hidden');
            container.innerHTML = saved.map((img, index) => `
                <div class="image-list-item">
                    <img src="${img.data}" alt="Saved ${index + 1}" onclick="viewSavedImage('${img.id}')">
                    <div class="flex-grow">
                        <p class="font-semibold text-gray-800">Imagen ${index + 1}</p>
                        <p class="text-xs text-gray-600">${img.date}</p>
                        <p class="text-xs text-gray-500">${formatBytes(Math.round(img.data.length * 0.75))}</p>
                    </div>
                    <button onclick="deleteSavedImage(${img.id})" class="text-red-500 hover:text-red-700 font-bold text-xl">üóëÔ∏è</button>
                </div>
            `).join('');
        }

        function viewSavedImage(id) {
            const saved = JSON.parse(localStorage.getItem('testImages') || '[]');
            const img = saved.find(i => i.id == id);
            if (img) {
                document.getElementById('fullSizeImage').src = img.data;
                document.getElementById('fullSizeModal').classList.remove('hidden');
            }
        }

        function deleteSavedImage(id) {
            let saved = JSON.parse(localStorage.getItem('testImages') || '[]');
            saved = saved.filter(i => i.id != id);
            localStorage.setItem('testImages', JSON.stringify(saved));
            loadSavedImages();
        }

        function clearAllSaved() {
            if (confirm('¬øEliminar todas las im√°genes guardadas?')) {
                localStorage.removeItem('testImages');
                loadSavedImages();
            }
        }

        function viewFullSize() {
            if (!currentImageData) return;
            document.getElementById('fullSizeImage').src = currentImageData;
            document.getElementById('fullSizeModal').classList.remove('hidden');
        }

        function closeFullSize() {
            document.getElementById('fullSizeModal').classList.add('hidden');
        }

        function downloadImage() {
            if (!currentImageData) return;
            const a = document.createElement('a');
            a.href = currentImageData;
            a.download = `compressed-${Date.now()}.jpg`;
            a.click();
        }

        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
        }
    </script>
</body>
</html>

